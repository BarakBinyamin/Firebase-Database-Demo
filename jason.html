<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<head>
<title>Database Demo</title>
</head>


<!-- start CSS for a card in html-->  
<style>
.card {
  width: responsive; 
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  margin-left: 200px;
  margin-right: 200px;
}

.container {
  padding: 2px 16px;
}

</style>
<!-- end CSS for a card in html-->


<body>
      <!-- The core Firebase JS SDK is always required and must be listed first -->
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-database.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

<script>
  // Your web app's Firebase configuration
GOOBER

  // Initialize Firebase, make a reference variable 
  firebase.initializeApp(firebaseConfig);
  var database = firebase.database();

//sets the folder "User" with no data - functionally clearing any data
function clearData(){
database.ref("User").set({
         });
}

//reloads the content of the page, this is done by looping over all of the elements with the keys "name" & 
//"content" within the folder "User" 
function reload_content(){
var page="";
/**these two lines of javascript are key to iterating through the database**/
firebase.database().ref("User").on('value', function(snap){
   snap.forEach(function(childNodes){

      //This loop iterates over children of user_id
      //childNodes.key is key of the children of userid such as (20170710)
      img = childNodes.val().image;

      //add the data into your preset html wrapper, be sure to escape special characters
      page += "<div class=\"card\">\r\n  <div class=\"container\" style=\"background: rgba(255, 255, 255, .5);\">\r\n   <img src=\"" + String(img) + "\" style=\"width: 600px; height: 500px; object-fit: scale-down;\">\r\n <\/div><\/div><\/div><\/div><br/>";


  });		//don't forget these!! 
});

document.getElementById("data").innerHTML = page  //set the element with the refernce "page" with the html that was just made
}

//add a grouping of data to the database
function push(image){
database.ref("User").push({
             image: String(image)
         });

}

//clear the textboxes
function clear_textbox(){
document.getElementById("textfeild").value = ""
document.getElementById("nameTextbox").value = ""
}

//centers page on a location
function goto(url)
    {
    window.location=url;

    }

//encode image and push to database
function encode() {
        var selectedfile = document.getElementById("myinput").files;
        if (selectedfile.length > 0) {
          var imageFile = selectedfile[0];
          var fileReader = new FileReader();
          fileReader.readAsDataURL(imageFile);      //to 64bit
          fileReader.onload = function(fileLoadedEvent) {
            var srcData = fileLoadedEvent.target.result; 
            console.log(srcData);	//look at it in the console
	    push(srcData);		
          }
        }
      }
</script>


<!--static html-->
<h1>Firebase Realtime Database Demo</h1>
<div style="height:1000px;font-size:36px;background: rgb(204, 204, 204); 
  background: rgba(204, 204, 204, 0); text-align:center;">
Let's test out the image database! <br/>Feel free to reload the page and use the clear button
<br/><br/><br/>


<p id= "data">loading...</p>	<!--dynamic html goes here-->

<!--static html-->
<div id="link">
<br/>
<input id="myinput" type="file" onchange="encode(), reload_content(),setTimeout(function(){ reload_content();setTimeout(function(){ reload_content(); }, 500) }, 500) " data-buttonText="Your label here."/>
<button onclick = "clearData(), reload_content()" style="font-size: 20px;">Clear</button>
<br/><br/><br/><br/><br/>

</div>
<!--Clear the textboxes on loading the page -->
<script> 
setTimeout(function(){ reload_content();setTimeout(function(){ reload_content(); }, 500) }, 500)
</script>

</div>
</body>
</html>

